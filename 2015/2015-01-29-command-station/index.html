<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Over the last few weeks I have been building an Arduino and Mac based DCC command station and today it all successfully came together with the running of my first locomotive under DCC control!" />
    <meta name="author" content="Peter Zegelin" />
    <meta name="generator" content="Ignite v0.7.0" />
    <title>MacDCC Command Station</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/css/bootstrap-icons.min.css" rel="stylesheet" />
    <link href="/css/ignite-core.css" rel="stylesheet" />
    <link href="https://www.nscalemodeller.com/2015/2015-01-29-command-station" rel="canonical" />
    <meta property="og:site_name" content="N Scale Modeller" />
    <meta property="og:title" content="MacDCC Command Station" />
    <meta name="twitter:title" content="MacDCC Command Station" />
    <meta property="og:description" content="Over the last few weeks I have been building an Arduino and Mac based DCC command station and today it all successfully came together with the running of my first locomotive under DCC control!" />
    <meta name="twitter:description" content="Over the last few weeks I have been building an Arduino and Mac based DCC command station and today it all successfully came together with the running of my first locomotive under DCC control!" />
    <meta property="og:url" content="https://www.nscalemodeller.com/2015/2015-01-29-command-station" />
    <meta name="twitter:domain" content="nscalemodeller.com" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:dnt" content="on" />
  </head>
  <body class="container">
    <div class="row justify-content-center g-3" style="padding: 20px">
      <div class="col align-self-center">
        <div class="mt-auto"></div>
      </div>
      <div class="col align-self-center">
        <div class="card" style="width: 1000px">
          <img src="/images/trainwreck.jpg" alt="" class="card-img" />
          <div class="card-img-overlay text-start align-content-end">
            <p style="font-size: 3.0em; margin-bottom: -15px; color: #ED6150; font-weight: 700">N Scale Modeller</p>
            <h3 style="font-weight: 200"><a href="/" style="text-decoration: none; color: #000000; padding-left: 20px">'experiments in n scale'</a></h3>
          </div>
        </div>
      </div>
      <div class="col align-self-center">
        <div class="mt-auto"></div>
      </div>
    </div>
    <div class="row justify-content-center g-3">
      <div class="ig-main-content col-md-8 align-self-start">
        <div class="d-flex justify-content-between align-items-center p-2">
          <a href="/2015/2015-01-30-software-available" style="text-decoration: none; color: #aaa">Previous Post</a>
          <a href="/2017/2017-01-18-old-post-1" style="text-decoration: none; color: #aaa">Next Post</a>
        </div>
        <div class="card" style="margin-bottom: 20px">
          <div class="card-body">
            <h2 class="card-title" style="text-decoration: none">MacDCC Command Station</h2>
            <h6 class="card-title">Using Arduino microcontrollers to send and monitor dcc signals</h6>
            <p class="card-text">Jan 2015</p>
            <p class="card-text"></p>
            <p>Over the last few weeks I have been building an Arduino and Mac based DCC command station and today it all successfully came together with the running of my first locomotive under DCC control!</p>
            <p>The Arduino software is quite simple, just receiving raw bytes from my Mac in a very simple format, which is then converted to DCC and sent out to a booster. The format is just a byte specifying how many further bytes are in the message, followed by the actual DCC bytes including checksum. After the required number of bytes have been received by the Arduino, the message is validated using the checksum, then replaces the oldest of the current two messages being sent. The Arduino software continuously sends out the last two commands that it receives so that no message is <a href="/2015/2015-01-09-thinking-about-a-command-station">sent twice in a row</a>. It is only a slight modification of the code mentioned in <a href="/2015/2015-01-02-sending-dcc-with-arduino">this post</a>.</p>
            <!--more--> 
            <p>The Mac side is a bit more complicated and no where near complete. However, it basically consists of a dispatcher which contains 2 queues of differing priorities, high and low. A message from a button or slider is put into either the high or low priority queue depending whether it is a loco message (mainly speed and emergency stop I think) or not. Meanwhile, the dispatcher sends messages out of the serial port to the Arduino, sending a few from the high priority queue in a round robin fashion and then one from the low priority queue, then back to the high priority queue, and so on. When a message has been sent a number times from the high priority queue it is removed from that queue and placed into the low priority queue and after it has been sent from the low priority queue a few times it is removed from the dispatcher. The stimulus to send another message comes from an acknowledgement from the Arduino that a message has been received. There is no error checking yet but so far it works well.</p>
            <p>A <a href="/2015/2015-01-02-sending-dcc-with-arduino">previous post</a> mentioned that I have been testing all this using two Arduinos hooked directly together without any of the booster hardware required to actually run a layout. This makes it much easier to debug the software side of things. However once I got the software up and running it was time to concentrate on the hardware. I first built the hardware side of the <a href="http://www.mynabay.com/dcc_monitor/">MynaBay DCC monitor</a> (<strong>UPDATE:</strong> This link is broken - see below) on a breadboard and hooked the transmitting Arduino directly to it (i.e. no booster). Luckily, things still worked, so it was time to build the booster. I built the one shown below, leaving out the thermal flag, overload and the filter (so basically just 4 caps and the LMD18200). Before I hooked up the output of the booster to the input of the Arduino monitor I ran a very basic blink type program on the ‘Command’ Arduino to make the input to the booster go very slowly high and low and checked the booster outputs with a multimeter. Sure enough, the outputs swung from approximately +14V to -14V in response. Next step was to hook the output of the booster to the input of the monitor hardware and reload the Arduino command software. Still working. Finally…. I wired up a short section of track to the booster and ran my first loco under DCC control!</p>
            <p>I only had a couple of problems that had to be sorted out. The 11 legs of the LMD18200 have a non standard spacing so they won’t fit into a proto-board so I ended up soldering a wire to each leg. Apparently the LMD is also static sensitive, which I only found out after I’d handled it quite a bit. Still worked though. The Arduino transmitter was also self powered rather than via the same power supply as the booster in the diagram so I had to add a ground wire from the Arduino to the booster.</p>
            <p>Here is a schematic of the LMD18200 booster - taken from now defunct OScale.net website. Similar LMD18200 based modules are available by Googling.</p>
            <p></p>
            <div class="text-center">
              <a href="/images/2015/dcc-booster.jpg"><img src="/images/2015/dcc-booster.jpg" height=" 250" style="margin: 0px 0px 10px 5px; padding: 2px; border: 1px solid grey;" /></a>
            </div>
            <p></p>
            <p>Unfortunately I don’t have a schematic for the MynaBay DCC decoder but is is a very simple circuit using an opto-coupler. There a many of these available with a search.</p>
            <p>Here is a picture of the setup. Note that I just wired up the LMD18200 directly to the prototyping board rather than use the breakout board as shown here.</p>
            <p></p>
            <div class="text-center">
              <a href="/images/2015/booster-decoder.jpg"><img src="/images/2015/booster-decoder.jpg" height=" 250" style="margin: 0px 0px 10px 5px; padding: 2px; border: 1px solid grey;" /></a>
            </div>
            <p></p>
            <p>In a couple of days I will add the Arduino transmitter code ( modified from O-scale ), the booster testing ‘blink’ program and the MacDCC command station software to my download page.</p>
            <p></p>
          </div>
          <div class="card-footer text-body-secondary">
            <div style="margin-top: -5px">
              <a rel="tag" href="/tags/arduino"><span class="badge text-bg-primary rounded-pill">Arduino</span></a>
              <a rel="tag" href="/tags/d-c-c"><span class="badge text-bg-primary rounded-pill">DCC</span></a>
              <a rel="tag" href="/tags/d-c-c-command-station"><span class="badge text-bg-primary rounded-pill">DCC Command Station</span></a>
            </div>
          </div>
        </div>
      </div>
      <div class="sticky-top col align-self-start" style="padding-bottom: 20px">
        <div class="card" style="margin-bottom: 20px">
          <div class="card-header">
            Pages
          </div>
          <div class="card-body">
            <ul class="mb-0" style="list-style: none">
              <li><a href="/" class="m-0" style="text-decoration: none; color: #aaa">Home</a></li>
              <li><a href="/links" class="m-0" style="text-decoration: none; color: #aaa">Arduino DCC Links</a></li>
              <li><a href="/downloads" class="m-0" style="text-decoration: none; color: #aaa">Software Downloads</a></li>
              <li><a href="/about" class="m-0" style="text-decoration: none; color: #aaa">About</a></li>
              <li><a href="/disclaimer" class="m-0" style="text-decoration: none; color: #aaa">Disclaimer</a></li>
            </ul>
          </div>
        </div>
        <div class="card" style="margin-bottom: 20px">
          <div class="card-header">
            Top Posts
          </div>
          <div class="card-body">
            <ul class="mb-0" style="list-style: none">
              <li><a href="/2019/2019-05-10-linear-stepper" style="text-decoration: none; color: #aaa">Linear Stepper to Operate Turnouts</a></li>
              <li><a href="/2017/2017-01-23-dremel-turnout-jig" style="text-decoration: none; color: #aaa">Dremel Tool Turnout Jig</a></li>
            </ul>
          </div>
        </div>
        <div class="card" style="margin-bottom: 20px">
          <div class="card-header">
            Recent Posts
          </div>
          <div class="card-body">
            <ul class="mb-0" style="list-style: none">
              <li><a href="/2019/2019-05-10-linear-stepper" style="text-decoration: none; color: #aaa">Linear Stepper to Operate Turnouts</a></li>
              <li><a href="/2018/2018-05-21-muscle-wire-update" style="text-decoration: none; color: #aaa">Muscle Wire Update</a></li>
              <li><a href="/2018/2018-05-20-muscle-wire" style="text-decoration: none; color: #aaa">Muscle Wire to Operate Turnouts</a></li>
              <li><a href="/2018/2018-04-15-rc-servos" style="text-decoration: none; color: #aaa">RC Servos to Operate Turnouts</a></li>
              <li><a href="/2017/2017-03-10-turnout-using-jig" style="text-decoration: none; color: #aaa">First Turnouts Using Dremel Tool Jig</a></li>
            </ul>
          </div>
        </div>
        <div class="card" style="margin-bottom: 20px">
          <div class="card-header">
            Tags
          </div>
          <div class="card-body">
            <ul class="mb-0" style="list-style: none">
              <li><a href="/tags/turnout-control" style="text-decoration: none; color: #aaa">Turnout Control</a></li>
              <li><a href="/tags/arduino" style="text-decoration: none; color: #aaa">Arduino</a></li>
              <li><a href="/tags/linear-stepper-motors" style="text-decoration: none; color: #aaa">Linear Stepper Motors</a></li>
              <li><a href="/tags/turnouts" style="text-decoration: none; color: #aaa">Turnouts</a></li>
              <li><a href="/tags/muscle-wire" style="text-decoration: none; color: #aaa">Muscle Wire</a></li>
              <li><a href="/tags/d-c-c-command-station" style="text-decoration: none; color: #aaa">DCC Command Station</a></li>
              <li><a href="/tags/software" style="text-decoration: none; color: #aaa">Software</a></li>
              <li><a href="/tags/uncategorized" style="text-decoration: none; color: #aaa">Uncategorized</a></li>
              <li><a href="/tags/d-c-c" style="text-decoration: none; color: #aaa">DCC</a></li>
              <li><a href="/tags/" style="text-decoration: none; color: #aaa">All tags</a></li>
            </ul>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            Archive
          </div>
          <div class="card-body">
            <ul class="mb-0" style="list-style: none">
              <li><a href="/2019" style="text-decoration: none; color: #aaa">2019</a></li>
              <li><a href="/2018" style="text-decoration: none; color: #aaa">2018</a></li>
              <li><a href="/2017" style="text-decoration: none; color: #aaa">2017</a></li>
              <li><a href="/2015" style="text-decoration: none; color: #aaa">2015</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-center m-2" style="font-size: 0.8em">
      <p>© 2015 - <span id="currentYear"></span> NScaleModeller.com |&nbsp;</p>
      <script>document.getElementById('currentYear').textContent = new Date().getFullYear();</script>
      <p>Created in Swift with <a href="https://github.com/twostraws/Ignite">Ignite</a></p>
      <p>&nbsp;| Source Code for this site is at <a href="https://github.com/nscalemodeller/nscalemodeller-website">GitHub </a></p>
    </div>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/ignite-core.js"></script>
  </body>
</html>